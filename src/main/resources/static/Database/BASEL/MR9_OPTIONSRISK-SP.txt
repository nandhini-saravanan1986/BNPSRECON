create or replace PROCEDURE MR9_OPTIONSRISK_PROCEDURE (REPORT_DATE VARCHAR2)
IS

V_REPORT_DATE DATE := TO_DATE (REPORT_DATE,'DD-MM-YYYY');
V_REPORT_DUE_DATE DATE := ADD_MONTHS  (LAST_DAY (V_REPORT_DATE),+3);
V_REPORT_FROM_DATE DATE := ADD_MONTHS (LAST_DAY (V_REPORT_DATE),-3);

--VARIABLE DECLARE
V_R1_PRODUCT 	VARCHAR2(100 BYTE)  := 'FOREIGN EXCHANGE';
V_R1_MARKETVALUE	NUMBER(24,4) := 0;
V_R1_DELTAWEIGHTED	NUMBER(24,4) := 0;
V_R1_CALCULATION	NUMBER(24,4) := 0;
V_R1_GAMMAIMPACT	NUMBER(24,4) := 0;
V_R1_GAMMACAPITALCHARGE	NUMBER(24,4) := 0;
V_R1_VEGACHARGE	NUMBER(24,4) := 0;
V_R1_CAPITALCHARGE	NUMBER(24,4) := 0;
V_R2_PRODUCT 	VARCHAR2(100 BYTE)  := 'INTEREST RATE';
V_R2_MARKETVALUE	NUMBER(24,4) := 0;
V_R2_DELTAWEIGHTED	NUMBER(24,4) := 0;
V_R2_CALCULATION	NUMBER(24,4) := 0;
V_R2_GAMMAIMPACT	NUMBER(24,4) := 0;
V_R2_GAMMACAPITALCHARGE 	NUMBER(24,4) := 0;
V_R2_VEGACHARGE	NUMBER(24,4) := 0;
V_R2_CAPITALCHARGE 	NUMBER(24,4) := 0;
V_R3_PRODUCT	VARCHAR2(100 BYTE)  := 'EQUITIES';
V_R3_MARKETVALUE	NUMBER(24,4) := 0;
V_R3_DELTAWEIGHTED	NUMBER(24,4) := 0;
V_R3_CALCULATION	NUMBER(24,4) := 0;
V_R3_GAMMAIMPACT	NUMBER(24,4) := 0;
V_R3_GAMMACAPITALCHARGE 	NUMBER(24,4) := 0;
V_R3_VEGACHARGE	NUMBER(24,4) := 0;
V_R3_CAPITALCHARGE	 NUMBER(24,4) := 0;
V_R4_PRODUCT	 VARCHAR2(100 BYTE)  := 'COMMODITIES';
V_R4_MARKETVALUE	NUMBER(24,4) := 0;
V_R4_DELTAWEIGHTED	NUMBER(24,4) := 0;
V_R4_CALCULATION	NUMBER(24,4) := 0;
V_R4_GAMMAIMPACT	NUMBER(24,4) := 0;
V_R4_GAMMACAPITALCHARGE 	NUMBER(24,4) := 0;
V_R4_VEGACHARGE	NUMBER(24,4) := 0;
V_R4_CAPITALCHARGE	 NUMBER(24,4) := 0;
V_R5_PRODUCT 	VARCHAR2(100 BYTE)  := 'SUB-TOTAL';
V_R5_MARKETVALUE	NUMBER(24,4) := 0;
V_R5_DELTAWEIGHTED	NUMBER(24,4) := 0;
V_R5_CALCULATION	NUMBER(24,4) := 0;
V_R5_GAMMAIMPACT	NUMBER(24,4) := 0;
V_R5_GAMMACAPITALCHARGE 	NUMBER(24,4) := 0;
V_R5_VEGACHARGE	NUMBER(24,4) := 0;
V_R5_CAPITALCHARGE	 NUMBER(24,4) := 0;


BEGIN

DELETE FROM MR9  WHERE REPORT_DATE=V_REPORT_DATE;

COMMIT;

Select count (*) into V_R1_MARKETVALUE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R1_DELTAWEIGHTED from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R1_CALCULATION from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R1_GAMMAIMPACT from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R1_GAMMACAPITALCHARGE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R1_VEGACHARGE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R2_MARKETVALUE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R2_DELTAWEIGHTED from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R2_CALCULATION from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R2_GAMMAIMPACT from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R2_GAMMACAPITALCHARGE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R2_VEGACHARGE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R3_MARKETVALUE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R3_DELTAWEIGHTED from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R3_CALCULATION from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R3_GAMMAIMPACT from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R3_GAMMACAPITALCHARGE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R3_VEGACHARGE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R4_MARKETVALUE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R4_DELTAWEIGHTED from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R4_CALCULATION from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R4_GAMMAIMPACT from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R4_GAMMACAPITALCHARGE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R4_VEGACHARGE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R1_MARKETVALUE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R1_DELTAWEIGHTED from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R1_CALCULATION from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R1_GAMMAIMPACT from tran_master_detail where REPORT_DATE =V_REPORT_DATE;

Select count (*) into V_R1_GAMMACAPITALCHARGE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;
Select count (*) into V_R1_VEGACHARGE from tran_master_detail where REPORT_DATE =V_REPORT_DATE;


V_R1_CAPITALCHARGE  := V_R1_GAMMACAPITALCHARGE + V_R1_VEGACHARGE ;
V_R2_CAPITALCHARGE  := V_R2_GAMMACAPITALCHARGE + V_R2_VEGACHARGE ;
V_R3_CAPITALCHARGE :=  V_R3_GAMMACAPITALCHARGE + V_R3_VEGACHARGE ;
V_R4_CAPITALCHARGE := V_R4_GAMMACAPITALCHARGE + V_R4_VEGACHARGE ;

V_R5_CAPITALCHARGE	 := V_R1_CAPITALCHARGE + V_R2_CAPITALCHARGE + V_R3_CAPITALCHARGE + V_R4_CAPITALCHARGE;

V_R5_MARKETVALUE := V_R1_MARKETVALUE + V_R2_MARKETVALUE + V_R3_MARKETVALUE + V_R4_MARKETVALUE;	
V_R5_DELTAWEIGHTED	:= V_R1_DELTAWEIGHTED + V_R2_DELTAWEIGHTED  + V_R3_DELTAWEIGHTED	+ V_R4_DELTAWEIGHTED;	

V_R5_GAMMAIMPACT := V_R1_GAMMAIMPACT + V_R2_GAMMAIMPACT + V_R3_GAMMAIMPACT + V_R4_GAMMAIMPACT;	
V_R5_GAMMACAPITALCHARGE := V_R1_GAMMACAPITALCHARGE  + V_R2_GAMMACAPITALCHARGE  + V_R3_GAMMACAPITALCHARGE  + V_R4_GAMMACAPITALCHARGE ;	
V_R5_VEGACHARGE := 	V_R1_VEGACHARGE + V_R2_VEGACHARGE + V_R3_VEGACHARGE + V_R4_VEGACHARGE;


INSERT INTO MR9 
(
R1_PRODUCT,
R1_MARKETVALUE,
R1_DELTAWEIGHTED,
R1_CALCULATION,
R1_GAMMAIMPACT,
R1_GAMMACAPITALCHARGE,
R1_VEGACHARGE,
R1_CAPITALCHARGE,
R2_PRODUCT,
R2_MARKETVALUE,
R2_DELTAWEIGHTED,
R2_CALCULATION,
R2_GAMMAIMPACT,
R2_GAMMACAPITALCHARGE,
R2_VEGACHARGE,
R2_CAPITALCHARGE,
R3_PRODUCT,
R3_MARKETVALUE,
R3_DELTAWEIGHTED,
R3_CALCULATION,
R3_GAMMAIMPACT,
R3_GAMMACAPITALCHARGE,
R3_VEGACHARGE,
R3_CAPITALCHARGE,
R4_PRODUCT,
R4_MARKETVALUE,
R4_DELTAWEIGHTED,
R4_CALCULATION,
R4_GAMMAIMPACT,
R4_GAMMACAPITALCHARGE,
R4_VEGACHARGE,
R4_CAPITALCHARGE,
R5_PRODUCT,
R5_MARKETVALUE,
R5_DELTAWEIGHTED,
R5_CALCULATION,
R5_GAMMAIMPACT,
R5_GAMMACAPITALCHARGE,
R5_VEGACHARGE,
R5_CAPITALCHARGE,
REPORT_DATE)
values
(
V_R1_PRODUCT,
V_R1_MARKETVALUE,
V_R1_DELTAWEIGHTED,
V_R1_CALCULATION,
V_R1_GAMMAIMPACT,
V_R1_GAMMACAPITALCHARGE,
V_R1_VEGACHARGE,
V_R1_CAPITALCHARGE,
V_R2_PRODUCT,
V_R2_MARKETVALUE,
V_R2_DELTAWEIGHTED,
V_R2_CALCULATION,
V_R2_GAMMAIMPACT,
V_R2_GAMMACAPITALCHARGE,
V_R2_VEGACHARGE,
V_R2_CAPITALCHARGE,
V_R3_PRODUCT,
V_R3_MARKETVALUE,
V_R3_DELTAWEIGHTED,
V_R3_CALCULATION,
V_R3_GAMMAIMPACT,
V_R3_GAMMACAPITALCHARGE,
V_R3_VEGACHARGE,
V_R3_CAPITALCHARGE,
V_R4_PRODUCT,
V_R4_MARKETVALUE,
V_R4_DELTAWEIGHTED,
V_R4_CALCULATION,
V_R4_GAMMAIMPACT,
V_R4_GAMMACAPITALCHARGE,
V_R4_VEGACHARGE,
V_R4_CAPITALCHARGE,
V_R5_PRODUCT,
V_R5_MARKETVALUE,
V_R5_DELTAWEIGHTED,
V_R5_CALCULATION,
V_R5_GAMMAIMPACT,
V_R5_GAMMACAPITALCHARGE,
V_R5_VEGACHARGE,
V_R5_CAPITALCHARGE,
V_REPORT_DATE);
COMMIT;
END;