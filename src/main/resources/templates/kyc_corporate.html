<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
		th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
	<link rel="stylesheet" type="text/css" href="/webjars/font-awesome/5.9.0/css/all.min.css"
		th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
	<link rel="stylesheet" type="text/css" href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
		th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
	<link rel="stylesheet" type="text/css" href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
		th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
	<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
	<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">

	<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
		th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
	<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
		th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
	<script src="/webjars/jquery/3.4.1/jquery.min.js" th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
	<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
		th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>

	<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
		th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>

	<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
		th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>

	<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
		th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
	<script src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
		th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>
</head>

<style>
	.btn-outline-primary2 {

		font-size: 16px;
		/* Better readability */

		transition: all 0.3s ease-in-out;
		/* Smooth transitions */
	}

	.headderbutton {
		font-weight: bold;
		font-size: large;
		color: #007bff;
	}

	.dropdown-item[title="View"] {
		display: none;
	}

	label {
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
		display: inline-block;
		max-width: 120%;
	}

	.radio-group {
		display: flex;
		gap: 3px;
		/* Space between each radio and label */
		flex-wrap: nowrap;
		/* Prevents wrapping to the next line */
	}



	.container-manager {
		width: 85%;
		height: 50%;
		padding-left: 128px;
		margin-right: 0;
		margin-left: 11%;
		margin-top: 100px;
		padding-bottom: 40px;
		font-size: 16px;
	}


	.custom-checkbox {
		width: 13px;
		/* Adjust width */
		height: 13px;
		/* Adjust height */
		/* Optional: add some margin */
		margin: 0;
		/* Optional: increase hit area */
		cursor: pointer;
	}

	input[type="number"]::-webkit-outer-spin-button,
	input[type="number"]::-webkit-inner-spin-button {
		-webkit-appearance: none;
		margin: 0;
	}

	input[type="number"] {
		-moz-appearance: textfield;
		/* Firefox */
	}

	.label-truncate {
		display: inline-block;
		max-width: 100px;
		/* Adjust this width as needed */
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
		vertical-align: middle;
	}
</style>
<script type="text/javascript">
	function goHome() {
		window.location.href = '/BRBS/';
	}
	function goBack() {
		window.history.back();
	}
	function refreshPage() {
		window.location.reload();
	}
	function corporatehome() {
		const srl_no = document.getElementById("srl_no")?.value;
		if (srl_no) {
			window.location.href = `/BRBS/kyc/corporate?srl_no=${encodeURIComponent(srl_no)}&formmode=modify`;
		} else {
			goHome();
		}
	}

	function modify(element) {
		const srl_no = element.getAttribute("data-resource");
	//	$('#loader1').modal("show");
		requestAnimationFrame(() => {
			window.location.href = `/BRBS/kyc/corporate?formmode=modify&srl_no=${encodeURIComponent(srl_no)}`;
		});
	}

	async function Downloaddoc(element) {
		const srl_no = element.getAttribute("data-resource");
	//	$('#loader1').modal('show');
		try {
			const response = await fetch(`/BRBS/kyc/corporate/download?srl_no=${encodeURIComponent(srl_no)}`);
			if (!response.ok) throw new Error(`Server error ${response.status}`);
			const blob = await response.blob();
			const link = document.createElement('a');
			link.href = URL.createObjectURL(blob);
			link.download = `${srl_no}.pdf`;
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
			$("#alertmsg_success").text("Download successful!");
			$("#alert_success").modal("show");
		} catch (error) {
			console.error("Download failed:", error);
			$("#alertmsg_failure").text("Download failed! Please try again.");
			$("#alert_failure").modal("show");
		} finally {
	//		$('#loader1').modal('hide');
		}
	}

	function verifyrecord(a) {
		const srl_no = a.getAttribute("data-srl_no");
		const Reviewdate = document.getElementById('review_date').value;
		const Reviewdesig = document.getElementById('reviewed_by_designation').value;
		const Branchname = document.getElementById('branch_name').value;
		const Approvaldate = document.getElementById('approval_date').value;
		const Approvaldesig = document.getElementById('approved_by_designation').value;
	//	$('#loader1').modal('show');
	if ((Reviewdate && Reviewdesig && Branchname && Approvaldate && Approvaldesig)) {
		$.ajax({
			url: '/BRBS/kyc/corporate/verify',
			type: 'POST',
			data: {formmode: 'verified', custid: srl_no}
		})
			.done(function () {
				$("#alertmsg_success").text("Verified successfully!");
				$("#alert_success").modal("show");
				$('#alert_success').find('.btn-primary').attr("onclick", "location.reload();");
			})
			.fail(function () {
				$("#alertmsg_failure").text("Verification failed!");
				$("#alert_failure").modal("show");
			})
			.always(function () {
	//			$('#loader1').modal('hide');
			});
			}else{
				alert("Oops! Some reviewer or upload information is still missing. Please double-check and complete all fields.");
			}
	}

	/**
	 * Handles the FINAL 'Submit' button click at the bottom of the page.
	 */
	async function modifysubmit() {
		const form = document.getElementById('kycForm');
		const confirmationCheckbox = document.getElementById('confirm_screening_cb');
		if (confirmationCheckbox && !confirmationCheckbox.checked) {
			alert('Please confirm that you have done screening of all account holders by checking the box.');
			confirmationCheckbox.focus();
			return;
		}

	//	$('#loader1').modal('show');
		const allDisabledElements = Array.from(form.querySelectorAll('input:disabled, select:disabled, textarea:disabled'));
		allDisabledElements.forEach(el => el.disabled = false);

		try {
			const formData = new FormData(form);
			formData.set("auth_flg", "Y");
			form.querySelectorAll('.format-as-number').forEach(input => {
				if (formData.has(input.name)) {
					formData.set(input.name, String(formData.get(input.name)).replace(/,/g, ''));
				}
			});

			const response = await fetch(form.action, {method: 'POST', body: formData});
			if (!response.ok) {
				const errorText = await response.text();
				throw new Error(errorText || `Server error ${response.status}`);
			}

			// On success, reload the page to get fresh data and see the correct button state
			$('#alertmsg_success').text("All changes submitted successfully!");
			$('#alert_success').modal('show');
			$('#alert_success .btn-primary').attr("onclick", "goBack();");

		} catch (error) {
			console.error("Submit failed:", error);
			$('#alertmsg_failure').text(`Error: ${error.message}`);
			$('#alert_failure').modal('show');
		} finally {
			allDisabledElements.forEach(el => el.disabled = true);
	//		$('#loader1').modal('hide');
		}
	}

	document.addEventListener("DOMContentLoaded", () => {
	//	$('#loader1').modal('hide');
		window.addEventListener('pageshow', (event) => {if (event.persisted) 
			$('#loader1').modal('hide');});
	});

</script>

<title>XBRL</title>

<body>
	<div class="col-sm-2">
		<div th:insert="XBRLHeaderMenu :: header"></div>
	</div>

	<!-- Start Content-->
	<div class="container-manager">
		<div class="btn-outline-primary2">
			<div class="row" th:each="user_data: ${user_data}">
				<div class="col-sm-11 ml-5 mt-2">
					<div class="card">
						<!-- COMMON HEADER WITH ACTION BUTTON -->
						<div class="card-header d-flex justify-content-between align-items-center"
							style="background: linear-gradient(115deg, #6495ED, white);">
							<h3 style="font-weight: bold; font-family: 'Verdana', sans-serif; font-size: 2.0rem; color: white;"
								class="mb-0"
								th:text="${formmode == 'view'} ? 'KYC-View' : 'KYC-(Non-Individual Customers)'">
							</h3>

							<!-- COMMON ACTION DROPDOWN -->
							<!-- === CORRECTED BUTTONS SECTION FOR CORPORATE PAGE === -->
							<div class="float-right d-flex align-items-center">

								<!-- DOWNLOAD BUTTON -->
								<button class="btn btn-success mr-2" type="button"
									style="min-width: 120px; font-weight: bold;"
									th:attr="onclick=|openDownloadModal('${user_data.customer_id}')|">
									<i class="fas fa-download mr-2"></i>Download Related Doc's'
								</button>

								<!-- UPLOAD BUTTON -->
								<button class="btn btn-primary mr-2" type="button"
									style="min-width: 100px; font-weight: bold;"
									th:attr="onclick=|openUploadModal('${user_data.srl_no}', '${user_data.customer_id}', 'CORPORATE')|">
									<i class="fas fa-upload mr-2"></i>Upload Related Doc's'
								</button>

								<!-- ORIGINAL ACTION DROPDOWN -->
								<div class="dropdown">
									<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"
										style="min-width: 100px; font-weight: bold;">Action</button>
									<div class="dropdown-menu">
										<a class="dropdown-item" title="Download Report" style="font-weight: bold"
											th:attr="data-resource=${user_data.srl_no}"
											th:if="${user_data.entity_flg == 'Y' and user_data.modify_flg == 'N'}"
											onclick="Downloaddoc(this)">Download Report</a>
									</div>
								</div>

							</div>
						</div>

						<!-- VIEW MODE CONTENT -->
						<div class="card-body" th:if="${formmode == 'view'}" id="kycViewForm">
							<h6><strong>ECDD-Diligence Form</strong></h6>
							<h6><strong>(Non-Individual Customers)</strong></h6>

							<table class="table table-bordered">
								<tr>
									<td colspan="1"><strong>Company Name</strong></td>
									<td colspan="3">
										<input type="text" class="form-control" th:name="companyName"
											th:value="${user_data.company_name}">
									</td>
									<td colspan="1"><strong>ECDD Date</strong></td>
									<td colspan="1">
										<input type="date" class="form-control" th:name="ecdd_date"
											th:value="${user_data.ecdd_date}">
									</td>
								</tr>
								<tr>
									<td colspan="1"><strong>Customer ID</strong></td>
									<td colspan="1">
										<input type="text" class="form-control" th:name="customerId"
											th:value="${user_data.customer_id}">
										<input type="hidden" class="form-control" th:name="srl_no"
											th:value="${user_data.srl_no}">
									</td>
									<td colspan="1"><strong>Associated Account Number(s)</strong></td>
									<td colspan="3">
										<input type="text" class="form-control" th:name="associated_account_number"
											th:value="${user_data.associated_account_number}">
									</td>
								</tr>
							</table>

							<!-- CORPORATE CUSTOMER INFORMATION -->
							<table class="table table-bordered">
								<tr style="background-color: #fce2dc;">
									<td colspan="8"><strong>1. CORPORATE CUSTOMER INFORMATION</strong></td>
								</tr>
								<tr>
									<th colspan="2" rowspan="2">Trade License Details</th>
									<th colspan="2">Number</th>
									<th colspan="2">Legal Status <small><i>(LLC,FZC,etc.)</i></small></th>
									<th colspan="2">Expiry Date</th>
								</tr>
								<tr>
									<td colspan="2">
										<input type="text" class="form-control" th:name="trade_license_number"
											th:value="${user_data.trade_license_number}">
									</td>
									<td colspan="2">
										<input type="text" class="form-control" th:name="trade_legal_status"
											th:value="${user_data.trade_legal_status}">
									</td>
									<td colspan="2">
										<input type="date" class="form-control" th:name="trade_expiry_date"
											th:value="${user_data.trade_expiry_date}">
									</td>
								</tr>
								<tr>
									<td colspan="2"><strong>Company Address</strong></td>
									<td colspan="6">
										<input type="text" class="form-control" th:name="company_address"
											th:value="${user_data.company_address}">
									</td>
								</tr>

								<!-- DEVELOPMENTS & CHANGES SECTION -->
								<tr style="background-color: #fce2dc;">
									<td colspan="8"><strong>2. DEVELOPEMENT & CHANGES SINCE LAST UPDATE</strong></td>
								</tr>
								<tr>
									<td colspan="5">
										<strong>If there is any triggered event (i.e. change/development observed
											in)</strong>
										<br><i>1) Entity Name</i>
										<br><i>2) Ownership Structure</i>
										<br><i>3) Legal Status of Entity</i>
										<br><i>4) Activity or Product</i>
										<input type="text" class="form-control" th:name="triggered_event"
											th:value="${user_data.triggered_event}">
										<br><strong>Please avoid this form and Prepare Detailed ECDD</strong>
									</td>
									<td colspan="3">(If No Change, mention and Proceed)-
										<br>
										<textarea class="form-control" th:name="no_change_reason"
											th:text="${user_data.no_change_reason}"></textarea>

									</td>
								</tr>

								<!-- RISK ASSESSMENT SECTION -->
								<tr style="background-color: #fce2dc;">
									<td colspan="8"><strong>3. RISK ASSESSMENT</strong></td>
								</tr>
								<tr>
									<td colspan="4"><strong>Geographic Risk Profile <i>(List of countries where co.has
												existing or started new operations)</i></strong></td>
									<td colspan="4">
										<input type="text" class="form-control" th:name="geographic_risk_profile"
											th:value="${user_data.geographic_risk_profile}">
									</td>
								</tr>
								<tr>
									<td colspan="4"><strong>Business Activity & Products</strong></td>
									<td colspan="4">
										<input type="text" class="form-control" th:name="business_activity_products"
											th:value="${user_data.business_activity_products}">
									</td>
								</tr>

								<!-- KYC DETAILS SECTION -->
								<tr style="background-color: #fce2dc;">
									<td colspan="8"><strong>4. KYC Details</strong></td>
								</tr>
								<tr>
									<td colspan="2"><strong>KYC Type</strong></td>
									<td colspan="2"><strong>Validity</strong></td>
									<td colspan="4"><strong>Remarks<i> (Details of action initiated,incase of expired
												documents)</i></strong></td>
								</tr>
								<tr>
									<td colspan="2"><strong>Trade License</strong></td>
									<td colspan="2">
										<strong>Valid/Expired
											<input type="text" class="form-control" th:name="trade_license_validity"
												th:value="${user_data.trade_license_validity}">
										</strong>
									</td>

									<td colspan="4">
										<br>
										<textarea class="form-control" name="trade_license_remarks" rows="1"
											th:text="${user_data?.trade_license_remarks}"></textarea>
									</td>
								</tr>
								<tr>
									<td colspan="2"><strong>UBOs'/Singatories'KYC</strong></td>
									<td colspan="2">
										<strong>Valid/Expired
											<input type="text" class="form-control"
												th:name="ubo_signatories_kyc_validity"
												th:value="${user_data.ubo_signatories_kyc_validity}">
										</strong>
									</td>
									<td colspan="4">
										<br>

										<textarea class="form-control" name="ubo_signatories_kyc_remarks" rows="1"
											th:text="${user_data?.ubo_signatories_kyc_remarks}"></textarea>
									</td>
								</tr>
								<tr>
									<td colspan="2"><strong>PEP Status</strong></td>
									<td colspan="2">
										<strong>Yes/No
											<input type="text" class="form-control" th:name="pep_status"
												th:value="${user_data.pep_status}">
										</strong>
									</td>
									<td colspan="4">
										<strong>if PEP as “Yes” </strong><br>
										<textarea class="form-control" name="pep_remarks" rows="1"
											th:text="${user_data?.pep_remarks}"></textarea>
									</td>
								</tr>

								<!-- COUNTERPARTIES SECTION -->
								<tr style="background-color: #fce2dc;">
									<td colspan="8"><strong>5. COUNTERPARTIES (NEWLY INTRODUCED DURING THE
											PERIOD))</strong></td>
								</tr>
								<tr>
									<th colspan="4">Name</th>
									<th colspan="1">Import/Export</th>
									<th colspan="1">Country</th>
									<th colspan="3">Activity/Products</th>
								</tr>
								<!-- Counterparty Rows 1-5 -->
								<tr th:each="i : ${#numbers.sequence(1, 5)}">
									<td colspan="4">
										<input type="text" class="form-control" th:name="'counterparty_name_' + ${i}"
											th:value="${user_data['counterparty_name_' + i]}">
									</td>
									<td>
										<input type="text" class="form-control"
											th:name="'counterparty_import_export_' + ${i}"
											th:value="${user_data['counterparty_import_export_' + i]}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="'counterparty_country_' + ${i}"
											th:value="${user_data['counterparty_country_' + i]}">
									</td>
									<td colspan="2">
										<input type="text" class="form-control"
											th:name="'counterparty_activity_products_' + ${i}"
											th:value="${user_data['counterparty_activity_products_' + i]}">
									</td>
								</tr>

								<!-- DUE DILIGENCE SECTION -->
								<tr style="background-color: #fce2dc;">
									<td colspan="9"><strong>6. DUE DILIGENCE / SCREENING REPORTS</strong></td>
								</tr>
								<tr>
									<th colspan="1"></th>
									<th>
										<span style="display: block;">CBUAE BBL CHECK DONE</span>
										<span style="display: block;">(Yes/No)</span>
									</th>
									<th>
										<span style="display: block;">Google</span>
										<span style="display: block;">(Yes/No)</span>
									</th>
									<th>
										<span style="display: block;">Dow-Jones</span>
										<span style="display: block;">(Yes/No)</span>
									</th>
									<!--<th colspan="1">
										<span style="display: block;">Internal Deny</span>
										<span style="display: block;">List (HAMLUPL)</span>
										<span style="display: block;">(Yes/No)</span>
									</th>-->
									<th colspan="5">Br.Remarks (If any adverse found)</th>
								</tr>

								<!-- Corporate -->
								<tr>
									<td><strong>Corporate</strong></td>
									<td><input type="text" class="form-control"
											th:value="${user_data.corporate_cbuae_bbl == 'Yes' ? 'Yes' : 'No'}"></td>
									<td><input type="text" class="form-control"
											th:value="${user_data.corporate_google_screening == 'Yes' ? 'Yes' : 'No'}">
									</td>
									<td><input type="text" class="form-control"
											th:value="${user_data.corporate_dow_jones_screening == 'Yes' ? 'Yes' : 'No'}">
									</td>
									<td colspan="5"><textarea class="form-control" rows="1"
											th:text="${user_data?.corporate_screening_remarks}"></textarea></td>
								</tr>
								<!-- UBO/Signatory -->
								<tr>
								<tr>
									<td><strong>Counter Party</strong></td>
									<td><input type="text" class="form-control"
											th:value="${user_data.counterparty_cbuae_bbl == 'Yes' ? 'Yes' : 'No'}"></td>
									<td><input type="text" class="form-control"
											th:value="${user_data.counterparty_google_screening == 'Yes' ? 'Yes' : 'No'}">
									</td>
									<td><input type="text" class="form-control"
											th:value="${user_data.counterparty_dow_jones_screening == 'Yes' ? 'Yes' : 'No'}">
									</td>
									<td colspan="5"><textarea class="form-control" rows="1"
											th:text="${user_data?.counterparty_screening_remarks}"></textarea></td>
								</tr>

								<!-- Counterparty -->
								<tr>
									<td colspan="1"><strong>Counter Party</strong></td>
									<td>
										<input type="text" class="form-control" th:name="counterparty_cbuae_bbl"
											th:value="${user_data.counterparty_cbuae_bbl}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="counterparty_google_screening"
											th:value="${user_data.counterparty_google_screening}">
									</td>
									<td>
										<input type="text" class="form-control"
											th:name="counterparty_dow_jones_screening"
											th:value="${user_data.counterparty_dow_jones_screening}">
									</td>
									<!--	<td colspan="1">-->
									<!--<input type="text" class="form-control"
											th:name="counterparty_internal_deny_list"
											th:value="${user_data.counterparty_internal_deny_list}">-->
									</td>
									<td colspan="5">
										<textarea class="form-control" name="counterparty_screening_remarks" rows="1"
											th:text="${user_data?.counterparty_screening_remarks}"></textarea>
									</td>
								</tr>


								<!-- TRANSACTION MONITORING SECTION -->
								<tr style="background-color: #fce2dc;">
									<td colspan="8"><strong>7. TRANSACTION MONITORING</strong>

										<!-- <button class="btn btn-sm btn-outline-dark"
											type="button" id="exportDropdown"
											th:attr="data-resource=${user_data.customer_id}" 
											onclick="DownloadTransaction(this);"
											style="float: right;background-color: #ff9800;">
											<i class="fas fa-download mr-1"></i> Download Transactions
										</button> -->
									</td>
								</tr>
								<tr>
									<td colspan="8">
										<strong>Transaction History</strong><small>(Details of unusual or suspicious
											transactions over
											the past 12 months)</small>
										<input type="text" class="form-control" th:name="transaction_history"
											th:value="${user_data.transaction_history}">
									</td>
								</tr>

								<tr>
									<td colspan="8">
										<strong>Conduct of the account</strong><small>(Any suspicious activity or risk
											indicators or
											ISTR filed during ECDD period)</small>
										<input type="text" class="form-control" th:name="account_conduct"
											th:value="${user_data.account_conduct}">
									</td>
								</tr>

								<tr>
									<td colspan="4"><strong>High Value Transaction Monitoring (Above 1 million)</strong>
									</td>
									<td colspan="1"><strong>No.of Transaction</strong></td>
									<td>
										<input type="text" class="form-control" th:name="high_value_transaction_count"
											th:value="${user_data.high_value_transaction_count}">
									</td>
									<td><strong>Volume</strong></td>
									<td>
										<input type="text" class="form-control" th:name="high_value_transaction_volume"
											th:value="${user_data.high_value_transaction_volume}">
									</td>
								</tr>

								<tr>
									<td colspan="6"><strong>Frequency and Volume of transactions During The Period(%
											w.r.t Annual Turnover)</strong></td>
									<td colspan="2"><strong>No.of Transactions & Turnover</strong></td>
								</tr>
								<tr>
									<td colspan="2"></td>
									<td>
										<strong>Cash</strong>
									</td>
									<td>
										<strong>Cheque</strong>
									</td>
									<td>
										<strong>Local transfer</strong>
									</td>
									<td>
										<strong>International Transfer</strong>
									</td>
									<td>
										<strong>Current</strong>
									</td>
									<td>
										<strong>Expected</strong>
									</td>
								</tr>
								<tr>
									<td colspan="2"><strong>No.of Transactions(%)</strong></td>
									<td colspan="1">
										<input type="text" class="form-control" th:name="cash_transaction_percent"
											th:value="${user_data.cash_transaction_percent}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="cheque_transaction_percent"
											th:value="${user_data.cheque_transaction_percent}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="local_transfer_percent"
											th:value="${user_data.local_transfer_percent}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="intl_transfer_percent"
											th:value="${user_data.intl_transfer_percent}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="current_transaction_count"
											th:value="${user_data.current_transaction_count}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="expected_transaction_count"
											th:value="${user_data.expected_transaction_count}">
									</td>
								</tr>
								<tr>
									<td colspan="2"><strong>Volume(%)</strong></td>
									<td>
										<input type="text" class="form-control" th:name="cash_volume_percent"
											th:value="${user_data.cash_volume_percent}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="cheque_volume_percent"
											th:value="${user_data.cheque_volume_percent}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="local_transfer_volume_percent"
											th:value="${user_data.local_transfer_volume_percent}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="intl_transfer_volume_percent"
											th:value="${user_data.intl_transfer_volume_percent}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="current_volume_count"
											th:value="${user_data.current_volume_count}">
									</td>
									<td>
										<input type="text" class="form-control" th:name="expected_volume_count"
											th:value="${user_data.expected_volume_count}">
									</td>
								</tr>
								<tr>
									<td colspan="8">
										<strong>Transactions in the account commensurate with business profile -YES/No
											<input type="text" class="form-control"
												th:value="${user_data.transactions_match_profile == 'Yes' ? 'Yes' : 'No'}">
											<i>(if No, please provide your justification,recommendations, and comments
												in
												section
												10)</i>
										</strong>
									</td>
								</tr>

								<!-- CUSTOMER RISK SECTION -->
								<tr style="background-color: #fce2dc;">
									<td colspan="8"><strong>8.CUSTOMER RISK & REASON FOR RISK CATEGORIZATION(AS PER
											CRA)</strong></td>
								</tr>
								<tr>
									<td colspan="2"><strong>System Risk</strong></td>
									<!--<td colspan="2"><strong>Latest Risk as per CRA</strong></td>-->
									<td colspan="6"><strong>Reason<i>(Any downgrade from system-driven risk must be
												approved by
												Territory compliance Department)</i></strong></td>
								</tr>
								<tr>
									<td colspan="1">
										<strong>High<br>Medium<br>Low</strong>
									</td>
									<td colspan="1">
										<br><input type="text" class="form-control" th:name="system_risk"
											th:value="${user_data.system_risk}">
									</td>
									<!--<td colspan="2"></td>-->
									<!--<td colspan="1">
										<strong>High<br>Medium<br>Low</strong>
									</td>
									<td colspan="1">
										<br><input type="text" class="form-control" th:name="latest_risk"
											th:value="${user_data.latest_risk}">
									</td>-->
									<td colspan="6">

										<textarea class="form-control" th:name="risk_reason"
											th:text="${user_data.risk_reason}"></textarea>
									</td>
								</tr>

								<!-- DOCUMENTS SECTION -->
								<tr style="background-color: #fce2dc;">
									<td colspan="8"><strong>9.Documents Availability in DMS</strong></td>
								</tr>
								<tr>
									<td colspan="4"><strong>AOF and FATCA/CRS & Others</strong></td>
									<td colspan="1"><strong>Availability <br>Check <br>Yes/No</strong></td>
									<td colspan="3"><strong>Remarks<i>(Details of action initiated,in case of
												unavailability of said document)</i></strong></td>
								</tr>
								<tr>
									<td colspan="4"><strong>Ensured the availability of AOF in DMS</strong></td>
									<td colspan="1">
										<input type="text" class="form-control"
											th:value="${user_data.aof_available == 'Yes' ? 'Yes' : 'No'}">
									</td>
									</td>
									<td colspan="3">
										<textarea class="form-control" name="aof_remarks" rows="1"
											th:text="${user_data?.aof_remarks}"></textarea>
									</td>
								</tr>
								<tr>
									<td colspan="4"><strong>Ensured the availability of FATCA/CRS Declaration & KYC Docs
											for Entity,UBOs & Signatories in DMS</strong></td>
									<td colspan="1">
										<input type="text" class="form-control"
											th:value="${user_data.fatca_crs_available == 'Yes' ? 'Yes' : 'No'}">
									</td>
									<td colspan="3">
										<textarea class="form-control" name="fatca_crs_remarks" rows="1"
											th:text="${user_data?.fatca_crs_remarks}"></textarea>
									</td>
								</tr>
								<tr>
									<td colspan="4"><strong>Ensured that Source of Funds documents available in
											DMS</strong></td>
									<td colspan="1">
										<input type="text" class="form-control"
											th:value="${user_data.source_of_funds_available == 'Yes' ? 'Yes' : 'No'}">
									</td>
									<td colspan="3">
										<textarea class="form-control" name="source_of_funds_remarks" rows="1"
											th:text="${user_data?.source_of_funds_remarks}"></textarea>
									</td>
								</tr>

								<!-- OBSERVATIONS SECTION -->
								<tr style="background-color: #fce2dc;">
									<td colspan="8"><strong>10. OBSERVATION & OTHER DUE DILIGENCE CARRIED BY THE
											BRANCH (Specific comments required for high risk accounts)</strong></td>
								</tr>
								<tr>
									<td colspan="8">
										<!-- <input type="text" class="form-control" th:name="observations"
											th:value="${user_data.observations}"> -->

										<textarea class="form-control" name="observations" maxlength="999" rows="6"
											th:text="${user_data.observations}"></textarea>
									</td>
								</tr>
							</table>

							<!-- REVIEWER & APPROVER SECTION -->
							<table class="table table-bordered">
								<tr>
									<td colspan="8" style="background-color: #fce2dc;"><strong>Branch - Reviewer &
											Approver</strong></td>
								</tr>
								<tr>
									<td colspan="5">
										<strong>Review Date</strong>
										<input type="date" class="form-control" th:name="review_date"
											th:value="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" />
										<br><br>

										<strong>Reviewed By -</strong>
										<br>
										<strong>(Name, EC No & Designation)</strong>
										<!-- reviewed_by_name shown only if workClass is 'M' -->
										<input type="text" class="form-control" th:name="reviewed_by_name"
											th:value="${user_data.reviewed_by_name}" />

										<!-- reviewed_by_ec_no shown only if workClass is 'M' -->
										<input type="text" class="form-control" th:name="reviewed_by_ec_no"
											th:value="${user_data.reviewed_by_ec_no}" />

										<input type="text" class="form-control" th:name="reviewed_by_designation"
											th:value="${user_data.reviewed_by_designation}" />
										<br><br>

										<strong>Branch -</strong>
										<input type="text" class="form-control" th:name="branch_name"
											th:value="${user_data.branch_name}" />
										<br><br>
									</td>


									<td colspan="3">
										<strong>Approval Date</strong>
										<input type="date" class="form-control" th:name="approval_date"
											th:value="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" />

										<br><br>

										<strong>Approved By -</strong>
										<br>
										<strong>(Name, EC No & Designation)</strong>

										<!-- approved_by_name shown only if workClass is 'C' -->
										<input type="text" class="form-control" th:name="approved_by_name"
											th:value="${user_data.approved_by_name}" />

										<!-- approved_by_ec_no shown only if workClass is 'C' -->
										<input type="text" class="form-control" th:name="approved_by_ec_no"
											th:value="${user_data.approved_by_ec_no}" />

										<input type="text" class="form-control" th:name="approved_by_designation"
											th:value="${user_data.approved_by_designation}">
										<br><br>
									</td>
								</tr>
							</table>

							<!-- DATA ENTRY SECTION -->
							<table class="table table-bordered">
								<tr>
									<td><strong></strong></td>
									<td colspan="1"><strong>Date</strong></td>
									<td colspan="6"><strong>Name of the Employee</strong></td>
								</tr>
								<tr>
									<td><strong>Data Entered in Finacle</strong></td>
									<td colspan="1">
										<input type="date" class="form-control" th:name="data_entry_date"
											th:value="${#dates.format(user_data.data_entry_date, 'yyyy-MM-dd')}">
									</td>
									<td colspan="6">
										<input type="text" class="form-control" th:name="data_entry_employee_name"
											th:value="${user_data.data_entry_employee_name}">
									</td>
								</tr>
								<tr>
									<td><strong>Document(s) Uploaded in DMS</strong></td>
									<td colspan="1">
										<input type="date" class="form-control" th:name="document_uploaded_date"
											th:value="${#dates.format(user_data.document_uploaded_date, 'yyyy-MM-dd')}">
									</td>
									<td colspan="6">
										<input type="text" class="form-control"
											th:name="document_uploaded_employee_name"
											th:value="${user_data.document_uploaded_employee_name}">
									</td>
								</tr>
							</table>
						</div>

						<!-- MODIFY MODE CONTENT -->
						<div class="card-body" th:if="${formmode == 'modify'}">
							<span style="color: red; font-weight: bold;"
								th:text="'SRL No: ' + ${user_data?.srl_no}"></span>

							<form method="post" id="kycForm" th:action="@{/kyc/corporate}"
								enctype="multipart/form-data">
								<input type="hidden" id="srl_no" name="srl_no" th:value="${user_data?.srl_no}" />
								<input type="hidden" name="formmode" value="submit" />

								<!-- Main Account Info -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<td colspan="4">
											<div class="d-flex justify-content-between align-items-center">
												<strong>Main Account Information</strong>
												<div class="section-actions d-flex align-items-center"
													data-target="s0_main_info">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tbody id="s0_main_info">
										<tr>
											<td><strong>Company Name</strong></td>
											<td><input type="text" class="form-control" name="company_name"
													maxlength="50" th:value="${user_data.company_name}" required></td>
											<td><strong>ECDD Date</strong></td>
											<td><input type="date" class="form-control" name="ecdd_date"
													th:value="${user_data.ecdd_date}"></td>
										</tr>
										<tr>
											<td><strong>Customer ID</strong></td>
											<td><input type="text" class="form-control" name="customer_id"
													maxlength="50" th:value="${user_data.customer_id}" readonly></td>
											<td><strong>Associated Account Number(s)</strong></td>
											<td><input type="text" class="form-control" name="associated_account_number"
													maxlength="100" th:value="${user_data.associated_account_number}">
											</td>
										</tr>
									</tbody>
								</table>

								<!-- Section 1: CORPORATE CUSTOMER INFORMATION -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<td colspan="4">
											<div class="d-flex justify-content-between align-items-center">
												<strong>1. CORPORATE CUSTOMER INFORMATION</strong>
												<div class="section-actions d-flex align-items-center"
													data-target="s1_corp_info">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tbody id="s1_corp_info">
										<tr>
											<th rowspan="2">Trade License Details</th>
											<th>Number</th>
											<th>Legal Status <small><i>(LLC,FZC,etc.)</i></small></th>
											<th>Expiry Date</th>
										</tr>
										<tr>
											<td><input type="text" class="form-control" name="trade_license_number"
													maxlength="50" th:value="${user_data.trade_license_number}"></td>
											<td><input type="text" class="form-control" name="trade_legal_status"
													maxlength="50" th:value="${user_data.trade_legal_status}"></td>
											<td><input type="date" class="form-control" name="trade_expiry_date"
													th:value="${user_data.trade_expiry_date}"></td>
										</tr>
										<tr>
											<td><strong>Company Address</strong></td>
											<td colspan="3"><input type="text" class="form-control"
													name="company_address" maxlength="100"
													th:value="${user_data.company_address}"></td>
										</tr>
									</tbody>
								</table>

								<!-- Section 2: DEVELOPMENTS & CHANGES -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<td colspan="2">
											<div class="d-flex justify-content-between align-items-center">
												<strong>2. DEVELOPEMENT & CHANGES SINCE LAST UPDATE</strong>
												<div class="section-actions d-flex align-items-center"
													data-target="s2_dev_changes">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tbody id="s2_dev_changes">
										<tr>
											<td style="width:50%;">
												<strong>If there is any triggered event (i.e. change/development
													observed in)</strong>
												<br><i>1) Entity Name, 2) Ownership Structure, 3) Legal Status, 4)
													Activity or Product</i>
												<input type="text" class="form-control" name="triggered_event"
													maxlength="50" th:value="${user_data.triggered_event}">
												<br><strong>Please avoid this form and Prepare Detailed ECDD</strong>
											</td>
											<td>
												<strong>(If No Change, mention and Proceed)</strong>
												<textarea class="form-control" name="no_change_reason" maxlength="100"
													th:text="${user_data.no_change_reason}"></textarea>
												<span class="char-counter">0 / 100</span>
											</td>
										</tr>
									</tbody>
								</table>

								<!-- Section 3: RISK ASSESSMENT -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<td colspan="2">
											<div class="d-flex justify-content-between align-items-center">
												<strong>3. RISK ASSESSMENT</strong>
												<div class="section-actions d-flex align-items-center"
													data-target="s3_risk_assessment">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tbody id="s3_risk_assessment">
										<tr>
											<td style="width:50%;"><strong>Geographic Risk Profile<i> (List of countries
														of new operations)</i></strong></td>
											<td><input type="text" class="form-control" name="geographic_risk_profile"
													maxlength="100" th:value="${user_data.geographic_risk_profile}">
											</td>
										</tr>
										<tr>
											<td><strong>Business Activity & Products</strong></td>
											<td><input type="text" class="form-control"
													name="business_activity_products" maxlength="100"
													th:value="${user_data.business_activity_products}"></td>
										</tr>
									</tbody>
								</table>

								<!-- Section 4: KYC Details -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<td colspan="3">
											<div class="d-flex justify-content-between align-items-center">
												<strong>4. KYC Details</strong>
												<div class="section-actions d-flex align-items-center"
													data-target="s4_kyc_details">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tbody id="s4_kyc_details">
										<tr>
											<th>KYC Type</th>
											<th>Validity</th>
											<th>Remarks<i> (Action for expired docs)</i></th>
										</tr>
										<tr>
											<td><strong>Trade License</strong></td>
											<td>
												<div class="form-check form-check-inline"><input
														class="form-check-input" type="radio"
														name="trade_license_validity" id="tl_v" value="Valid"
														th:checked="${user_data.trade_license_validity == 'Valid'}"><label
														class="form-check-label" for="tl_v">Valid</label></div>
												<div class="form-check form-check-inline"><input
														class="form-check-input" type="radio"
														name="trade_license_validity" id="tl_e" value="Expired"
														th:checked="${user_data.trade_license_validity == 'Expired'}"><label
														class="form-check-label" for="tl_e">Expired</label></div>
											</td>
											<td><textarea class="form-control" name="trade_license_remarks" rows="1"
													required
													th:text="${user_data?.trade_license_remarks}"></textarea></td>
										</tr>
										<tr>
											<td><strong>UBOs'/Signatories' KYC</strong></td>
											<td>
												<div class="form-check form-check-inline"><input
														class="form-check-input" type="radio"
														name="ubo_signatories_kyc_validity" id="ubo_v" value="Valid"
														th:checked="${user_data.ubo_signatories_kyc_validity == 'Valid'}"><label
														class="form-check-label" for="ubo_v">Valid</label></div>
												<div class="form-check form-check-inline"><input
														class="form-check-input" type="radio"
														name="ubo_signatories_kyc_validity" id="ubo_e" value="Expired"
														th:checked="${user_data.ubo_signatories_kyc_validity == 'Expired'}"><label
														class="form-check-label" for="ubo_e">Expired</label></div>
											</td>
											<td><textarea class="form-control" name="ubo_signatories_kyc_remarks"
													rows="1" required
													th:text="${user_data?.ubo_signatories_kyc_remarks}"></textarea></td>
										</tr>
										<tr>
											<td><strong>PEP Status</strong></td>
											<td>
												<div class="form-check form-check-inline"><input
														class="form-check-input" type="radio" name="pep_status"
														id="pep_y" value="Yes"
														th:checked="${user_data.pep_status == 'Yes'}"><label
														class="form-check-label" for="pep_y">Yes</label></div>
												<div class="form-check form-check-inline"><input
														class="form-check-input" type="radio" name="pep_status"
														id="pep_n" value="No"
														th:checked="${user_data.pep_status == 'No' or user_data.pep_status == null}"><label
														class="form-check-label" for="pep_n">No</label></div>
											</td>
											<td>
												<strong>If PEP is "Yes", provide details:</strong>
												<textarea class="form-control" name="pep_remarks" id="pep_remarks"
													rows="1" required
													th:text="${user_data?.pep_remarks}"></textarea>
											</td>
										</tr>
									</tbody>
								</table>

								<!-- Section 5: COUNTERPARTIES -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<td colspan="4">
											<div class="d-flex justify-content-between align-items-center">
												<strong>5. COUNTERPARTIES (NEWLY INTRODUCED)</strong>
												<div class="section-actions d-flex align-items-center"
													data-target="s5_counterparties">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tbody id="s5_counterparties">
										<tr>
											<th>Name</th>
											<th>Import/Export</th>
											<th>Country</th>
											<th>Activity/Products</th>
										</tr>
										<tr th:each="i : ${#numbers.sequence(1, 5)}">
											<td><input type="text" class="form-control"
													th:name="'counterparty_name_' + ${i}" maxlength="50"
													th:value="${user_data['counterparty_name_' + i]}"></td>
											<td><input type="text" class="form-control"
													th:name="'counterparty_import_export_' + ${i}" maxlength="50"
													th:value="${user_data['counterparty_import_export_' + i]}"></td>
											<td><input type="text" class="form-control"
													th:name="'counterparty_country_' + ${i}" maxlength="50"
													th:value="${user_data['counterparty_country_' + i]}"></td>
											<td><input type="text" class="form-control"
													th:name="'counterparty_activity_products_' + ${i}" maxlength="50"
													th:value="${user_data['counterparty_activity_products_' + i]}"></td>
										</tr>
									</tbody>
								</table>

								<!-- Section 6: DUE DILIGENCE -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<td colspan="5">
											<div class="d-flex justify-content-between align-items-center">
												<strong>6. DUE DILIGENCE / SCREENING REPORTS</strong>
												<div class="section-actions d-flex align-items-center"
													data-target="s6_due_diligence">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tbody id="s6_due_diligence">
										<tr>
											<th></th>
											<th>CBUAE BBL Check (Y/N)</th>
											<th>Google (Y/N)</th>
											<th>Dow-Jones (Y/N)</th>
											<th>Br. Remarks (If any adverse found)</th>
										</tr>
										<tr>
											<td><strong>Corporate</strong></td>
											<td>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="corp_bbl_y"
														name="corporate_cbuae_bbl" value="Yes"
														th:checked="${user_data.corporate_cbuae_bbl == 'Yes'}"> <label
														for="corp_bbl_y">Yes</label></div>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="corp_bbl_n"
														name="corporate_cbuae_bbl" value="No"
														th:checked="${user_data.corporate_cbuae_bbl != 'Yes'}"> <label
														for="corp_bbl_n">No</label></div>
											</td>
											<td>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="corp_goog_y"
														name="corporate_google_screening" value="Yes"
														th:checked="${user_data.corporate_google_screening == 'Yes'}">
													<label for="corp_goog_y">Yes</label>
												</div>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="corp_goog_n"
														name="corporate_google_screening" value="No"
														th:checked="${user_data.corporate_google_screening != 'Yes'}">
													<label for="corp_goog_n">No</label>
												</div>
											</td>
											<td>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="corp_dj_y"
														name="corporate_dow_jones_screening" value="Yes"
														th:checked="${user_data.corporate_dow_jones_screening == 'Yes'}">
													<label for="corp_dj_y">Yes</label>
												</div>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="corp_dj_n"
														name="corporate_dow_jones_screening" value="No"
														th:checked="${user_data.corporate_dow_jones_screening != 'Yes'}">
													<label for="corp_dj_n">No</label>
												</div>
											</td>
											<td><!--<textarea class="form-control" name="corporate_screening_remarks"
													rows="1" required minlength="30"
													th:text="${user_data?.corporate_screening_remarks}"></textarea>-->
													<input list="CorporateRemarksList" class="form-control" name="corporate_screening_remarks"
													 th:value="${user_data?.corporate_screening_remarks}"
														required placeholder="Type or select a remark" />
													
													<datalist id="CorporateRemarksList">
														<option value="Nothing adverse found">
														<option value="False Positive – Partial Name Match, Verified Not the Same Individual">
														<option value="Cleared – False Positive (Name Match Only)">
													</datalist>
												
												
												</td>
										</tr>
										<tr>
											<td><strong>UBO/Signatory</strong></td>
											<td>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="ubo_bbl_y" name="ubo_cbuae_bbl"
														value="Yes" th:checked="${user_data.ubo_cbuae_bbl == 'Yes'}">
													<label for="ubo_bbl_y">Yes</label>
												</div>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="ubo_bbl_n" name="ubo_cbuae_bbl"
														value="No" th:checked="${user_data.ubo_cbuae_bbl != 'Yes'}">
													<label for="ubo_bbl_n">No</label>
												</div>
											</td>
											<td>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="ubo_goog_y"
														name="ubo_google_screening" value="Yes"
														th:checked="${user_data.ubo_google_screening == 'Yes'}"> <label
														for="ubo_goog_y">Yes</label></div>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="ubo_goog_n"
														name="ubo_google_screening" value="No"
														th:checked="${user_data.ubo_google_screening != 'Yes'}"> <label
														for="ubo_goog_n">No</label></div>
											</td>
											<td>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="ubo_dj_y"
														name="ubo_dow_jones_screening" value="Yes"
														th:checked="${user_data.ubo_dow_jones_screening == 'Yes'}">
													<label for="ubo_dj_y">Yes</label>
												</div>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="ubo_dj_n"
														name="ubo_dow_jones_screening" value="No"
														th:checked="${user_data.ubo_dow_jones_screening != 'Yes'}">
													<label for="ubo_dj_n">No</label>
												</div>
											</td>
											<td><!--<textarea class="form-control" name="ubo_screening_remarks" rows="1"
													required minlength="30"
													th:text="${user_data?.ubo_screening_remarks}"></textarea>-->
												
													<input list="UBORemarksList" class="form-control" name="ubo_screening_remarks"
														th:value="${user_data?.ubo_screening_remarks}" required
														placeholder="Type or select a remark" />
													
													<datalist id="UBORemarksList">
														<option value="Nothing adverse found">
														<option value="False Positive – Partial Name Match, Verified Not the Same Individual">
														<option value="Cleared – False Positive (Name Match Only)">
													</datalist>
												</td>
										</tr>
										<tr>
											<td><strong>Counter Party</strong></td>
											<td>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="cp_bbl_y"
														name="counterparty_cbuae_bbl" value="Yes"
														th:checked="${user_data.counterparty_cbuae_bbl == 'Yes'}">
													<label for="cp_bbl_y">Yes</label>
												</div>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="cp_bbl_n"
														name="counterparty_cbuae_bbl" value="No"
														th:checked="${user_data.counterparty_cbuae_bbl != 'Yes'}">
													<label for="cp_bbl_n">No</label>
												</div>
											</td>
											<td>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="cp_goog_y"
														name="counterparty_google_screening" value="Yes"
														th:checked="${user_data.counterparty_google_screening == 'Yes'}">
													<label for="cp_goog_y">Yes</label>
												</div>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="cp_goog_n"
														name="counterparty_google_screening" value="No"
														th:checked="${user_data.counterparty_google_screening != 'Yes'}">
													<label for="cp_goog_n">No</label>
												</div>
											</td>
											<td>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="cp_dj_y"
														name="counterparty_dow_jones_screening" value="Yes"
														th:checked="${user_data.counterparty_dow_jones_screening == 'Yes'}">
													<label for="cp_dj_y">Yes</label>
												</div>
												<div class="form-check form-check-inline"><input type="radio"
														class="form-check-input" id="cp_dj_n"
														name="counterparty_dow_jones_screening" value="No"
														th:checked="${user_data.counterparty_dow_jones_screening != 'Yes'}">
													<label for="cp_dj_n">No</label>
												</div>
											</td>
											<td><!--<textarea class="form-control" name="counterparty_screening_remarks"
													rows="1" required minlength="30"
													th:text="${user_data?.counterparty_screening_remarks}"></textarea>-->
													<input list="CounterRemarksList" class="form-control" name="counterparty_screening_remarks"
														th:value="${user_data?.counterparty_screening_remarks}" required
														placeholder="Type or select a remark" />
													
													<datalist id="CounterRemarksList">
														<option value="Nothing adverse found">
														<option value="False Positive – Partial Name Match, Verified Not the Same Individual">
														<option value="Cleared – False Positive (Name Match Only)">
													</datalist>
												
												</td>
										</tr>
									</tbody>
								</table>

								<!-- Section 7: TRANSACTION MONITORING -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<td colspan="8">
											<div class="d-flex justify-content-between align-items-center">
												<strong>7. TRANSACTION MONITORING</strong>
												<div class="section-actions d-flex align-items-center"
													data-target="s7_txn_monitoring">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tbody id="s7_txn_monitoring">
										<tr>
											<td colspan="8"><strong>Transaction History</strong>
												<small>(Unusual/suspicious transactions)</small>
												<input type="text" class="form-control" name="transaction_history"
													maxlength="100" th:value="${user_data.transaction_history}">
											</td>
										</tr>
										<tr>
											<td colspan="8"><strong>Conduct of the account</strong> <small>(Suspicious
													activity/ISTR)</small>
												<input type="text" class="form-control" name="account_conduct"
													maxlength="100" th:value="${user_data.account_conduct}">
											</td>
										</tr>
										<tr>
											<td colspan="4"><strong>High Value Transaction Monitoring (Above 1
													million)</strong></td>
											<td><strong>No. of Txn</strong></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="high_value_transaction_count" maxlength="10"
													th:value="${user_data.high_value_transaction_count}"></td>
											<td><strong>Volume</strong></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="high_value_transaction_volume" maxlength="10"
													th:value="${user_data.high_value_transaction_volume}"></td>
										</tr>
										<tr>
											<td colspan="8" class="text-center"><strong>Frequency and Volume of
													transactions During The Period (% w.r.t Annual Turnover)</strong>
											</td>
										</tr>
										<tr class="text-center">
											<td></td>
											<td><strong>Cash</strong></td>
											<td><strong>Cheque</strong></td>
											<td><strong>Local</strong></td>
											<td><strong>Int'l</strong></td>
											<td style="background-color:#e9ecef"></td>
											<td><strong>Current</strong></td>
											<td><strong>Expected</strong></td>
										</tr>
										<tr>
											<td><strong>No. of Txn (%)</strong></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="cash_transaction_percent" maxlength="10"
													th:value="${user_data.cash_transaction_percent}"></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="cheque_transaction_percent" maxlength="10"
													th:value="${user_data.cheque_transaction_percent}"></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="local_transfer_percent" maxlength="10"
													th:value="${user_data.local_transfer_percent}"></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="intl_transfer_percent" maxlength="10"
													th:value="${user_data.intl_transfer_percent}"></td>
											<td style="background-color:#e9ecef"></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="current_transaction_count" maxlength="10"
													th:value="${user_data.current_transaction_count}"></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="expected_transaction_count" maxlength="10"
													th:value="${user_data.expected_transaction_count}"></td>
										</tr>
										<tr>
											<td><strong>Volume (%)</strong></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="cash_volume_percent" maxlength="10"
													th:value="${user_data.cash_volume_percent}"></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="cheque_volume_percent" maxlength="10"
													th:value="${user_data.cheque_volume_percent}"></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="local_transfer_volume_percent" maxlength="10"
													th:value="${user_data.local_transfer_volume_percent}"></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="intl_transfer_volume_percent" maxlength="10"
													th:value="${user_data.intl_transfer_volume_percent}"></td>
											<td style="background-color:#e9ecef"></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="current_volume_count" maxlength="10"
													th:value="${user_data.current_volume_count}"></td>
											<td><input type="text" class="form-control text-right format-as-number"
													name="expected_volume_count" maxlength="10"
													th:value="${user_data.expected_volume_count}"></td>
										</tr>
										<tr>
											<td colspan="8">
												<strong>Transactions commensurate with business profile?</strong>
												<div class="form-check form-check-inline ml-2"><input
														class="form-check-input" type="radio"
														name="transactions_match_profile" id="txp_y" value="Yes"
														th:checked="${user_data.transactions_match_profile == 'Yes'}"><label
														class="form-check-label" for="txp_y">Yes</label></div>
												<div class="form-check form-check-inline"><input
														class="form-check-input" type="radio"
														name="transactions_match_profile" id="txp_n" value="No"
														th:checked="${user_data.transactions_match_profile != 'Yes'}"><label
														class="form-check-label" for="txp_n">No</label></div>
												<br><i>(If No, provide justification in section 10)</i>
											</td>
										</tr>
									</tbody>
								</table>

								<!-- Section 8: CUSTOMER RISK -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<td colspan="2">
											<div class="d-flex justify-content-between align-items-center">
												<strong>8. CUSTOMER RISK & REASON FOR RISK CATEGORIZATION</strong>
												<div class="section-actions d-flex align-items-center"
													data-target="s8_cust_risk">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tbody id="s8_cust_risk">
										<tr>
											<td>
												<strong>System Risk</strong>
												<select class="form-control" name="system_risk">
													<option value="High"
														th:selected="${user_data.system_risk == 'High'}">High</option>
													<option value="Medium"
														th:selected="${user_data.system_risk == 'Medium'}">Medium
													</option>
													<option value="Low" th:selected="${user_data.system_risk == 'Low'}">
														Low</option>
												</select>
											</td>
											<td>
												<strong>Reason </strong><small><i>(Any downgrade requires Territory
														Compliance approval)</i></small>
												<textarea class="form-control" name="risk_reason" maxlength="100"
													th:text="${user_data.risk_reason}"></textarea>
												<span class="char-counter">0 /100</span>
											</td>
										</tr>
									</tbody>
								</table>

								<!-- Section 9: Documents Availability -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<td colspan="3">
											<div class="d-flex justify-content-between align-items-center">
												<strong>9. Documents Availability in DMS</strong>
												<div class="section-actions d-flex align-items-center"
													data-target="s9_docs">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tbody id="s9_docs">
										<tr>
											<td><strong>AOF and FATCA/CRS & Others</strong></td>
											<td><strong>Availability Check</strong></td>
											<td><strong>Remarks</strong> <small><i>(Action for
														non-availability)</i></small></td>
										</tr>
										<tr>
											<td>Ensured the availability of AOF in DMS</td>
											<td>
												<div class="form-check form-check-inline"><input
														class="form-check-input" id="aof_y" type="radio"
														name="aof_available" value="Yes"
														th:checked="${user_data.aof_available == 'Yes'}"> <label
														for="aof_y">Yes</label></div>
												<div class="form-check form-check-inline"><input
														class="form-check-input" id="aof_n" type="radio"
														name="aof_available" value="No"
														th:checked="${user_data.aof_available != 'Yes'}"> <label
														for="aof_n">No</label></div>
											</td>
											<td><textarea class="form-control" name="aof_remarks" rows="1" required
													th:text="${user_data?.aof_remarks}"></textarea></td>
										</tr>
										<tr>
											<td>Ensured availability of FATCA/CRS & KYC Docs</td>
											<td>
												<div class="form-check form-check-inline"><input
														class="form-check-input" id="fatca_y" type="radio"
														name="fatca_crs_available" value="Yes"
														th:checked="${user_data.fatca_crs_available == 'Yes'}"> <label
														for="fatca_y">Yes</label></div>
												<div class="form-check form-check-inline"><input
														class="form-check-input" id="fatca_n" type="radio"
														name="fatca_crs_available" value="No"
														th:checked="${user_data.fatca_crs_available != 'Yes'}"> <label
														for="fatca_n">No</label></div>
											</td>
											<td><textarea class="form-control" name="fatca_crs_remarks" rows="1"
													required
													th:text="${user_data?.fatca_crs_remarks}"></textarea>
											</td>
										</tr>
										<tr>
											<td>Ensured that Source of Funds documents available</td>
											<td>
												<div class="form-check form-check-inline"><input
														class="form-check-input" id="sof_y" type="radio"
														name="source_of_funds_available" value="Yes"
														th:checked="${user_data.source_of_funds_available == 'Yes'}">
													<label for="sof_y">Yes</label>
												</div>
												<div class="form-check form-check-inline"><input
														class="form-check-input" id="sof_n" type="radio"
														name="source_of_funds_available" value="No"
														th:checked="${user_data.source_of_funds_available != 'Yes'}">
													<label for="sof_n">No</label>
												</div>
											</td>
											<td><textarea class="form-control" name="source_of_funds_remarks" rows="1"
													required
													th:text="${user_data?.source_of_funds_remarks}"></textarea></td>
										</tr>
									</tbody>
								</table>

								<!-- Section 10: OBSERVATIONS -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<td>
											<div class="d-flex justify-content-between align-items-center">
												<strong>10. OBSERVATION & OTHER DUE DILIGENCE CARRIED BY THE
													BRANCH</strong>
												<div class="section-actions d-flex align-items-center"
													data-target="s10_observations">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tbody id="s10_observations">
										<tr>
											<td><textarea class="form-control" name="observations" maxlength="999"
													rows="4" th:text="${user_data.observations}"></textarea><span
													class="char-counter">0 / 999</span></td>
										</tr>
									</tbody>
								</table>

								<!-- Section 11: Branch Reviewer & Approver & Data Entry -->
								<!-- === Section 11: Branch - Reviewer, Approver & Head (UPDATED for Corporate) === -->
								<table class="table table-bordered mb-4">
									<tr style="background-color: #fce2dc;">
										<th colspan="3">
											<div class="d-flex justify-content-between align-items-center">
												<span>Branch - Reviewer, Approver & Head</span>
												<div class="section-actions d-flex align-items-center"
													data-target="s11_approver">
													<span class="save-status font-weight-bold mr-3"></span>
													<button type="button"
														class="btn btn-sm btn-outline-primary modify-btn"
														title="Modify"><i class="fas fa-edit"></i></button>
													<div class="save-cancel-controls d-none">
														<button type="button" class="btn btn-sm btn-success save-btn"
															aria-label="Save Changes">✓ <i
																class="fa fa-spinner fa-spin ml-1 d-none"></i></button>
														<button type="button"
															class="btn btn-sm btn-danger cancel-btn ml-1"
															aria-label="Cancel Changes">✗</button>
													</div>
												</div>
											</div>
										</th>
									</tr>
									<tbody id="s11_approver">
										<tr>
											<!-- Column 1: Reviewer -->
											<td style="vertical-align: top; width: 33%;">
												<strong>Review Date</strong>
												<input type="date" class="form-control" name="review_date" id="review_date"
													th:value="${user_data.review_date}" />
												<br><strong>Reviewed By - (Name, EC No & Designation<span
														style="color:red;">*</span>)</strong>
												<input type="text" class="form-control" name="reviewed_by_name"
													th:value="${session.WORKCLASS == 'M' ? session.USERNAME : user_data.reviewed_by_name}"
													readonly />
												<input type="text" class="form-control mt-1" name="reviewed_by_ec_no"
													th:value="${session.WORKCLASS == 'M' ? session.USERID : user_data.reviewed_by_ec_no}"
													readonly />
												<input type="text" class="form-control mt-1"
													name="reviewed_by_designation" maxlength="50" id="reviewed_by_designation"
													th:value="${user_data.reviewed_by_designation}" required>
												<br><strong>Branch -</strong>
												<input type="text" class="form-control" name="branch_name" id="branch_name"
													maxlength="50" th:value="${user_data.branch_name}">
											</td>
											<!-- Column 2: Approver -->
											<td style="vertical-align: top; width: 33%;">
												<strong>Approval Date</strong>
												<input type="date" class="form-control" name="approval_date"  id="approval_date"
													th:value="${user_data.approval_date}" />  
												<br><strong>Approved By - (Name, EC No & Designation<span
														style="color:red;">*</span>)</strong>
												<input type="text" class="form-control" name="approved_by_name"
													th:value="${session.WORKCLASS == 'C' ? session.USERNAME : user_data.approved_by_name}"
													readonly />
												<input type="text" class="form-control mt-1" name="approved_by_ec_no"
													th:value="${session.WORKCLASS == 'C' ? session.USERID : user_data.approved_by_ec_no}"
													readonly />
												<input type="text" class="form-control mt-1"
													name="approved_by_designation" maxlength="50" id="approved_by_designation"
													th:value="${user_data.approved_by_designation}" required>
											</td>
											<!-- Column 3: Branch Head Signature (NEW) -->
											<td style="vertical-align: top; width: 34%;">
												<strong>Branch Head/Operation Head Signature</strong>
												<div
													style="height: 125px; border: 1px dashed #ccc; margin-top: 1rem; display: flex; align-items: center; justify-content: center; color: #aaa;">
													(Manual Signature Area)
												</div>
												<strong class="mt-2 d-block">Name:</strong>
												<input type="text" class="form-control" name="head_signature_name"
													placeholder="Manual Entry after download" maxlength="100"
													readonly />
											</td>
										</tr>
										<!-- ... your data entry rows can stay here ... -->
									</tbody>
								</table>
							</form>
						</div>

						<!-- CARD FOOTER -->
						<div class="card-footer text-center">
							<div class="footer-confirmation" th:if="${formmode == 'modify'}">
								<input type="checkbox" id="confirm_screening_cb" name="auth_flg" value="Y" 
								required="required" th:attr="checked=${user_data.auth_flg == 'Y'} ? 'checked' : null								   ,
								disabled=${user_data.auth_flg == 'Y'} ? 'disabled' : null"
								style="width: 1rem; height: 1rem; vertical-align: middle;" />
								<label for="confirm_screening_cb" class="ml-2"
									style="font-weight: normal; font-style: normal;">
									I confirm that I have done screening of All Account holders & kept on record.
								</label>
							</div>

							<button type="button" class="btn btn-xs headderbutton" onclick="goHome();">Home</button>

							<button type="button" th:if="${formmode == 'modify' and user_data.modify_flg == 'N'}" class="btn btn-xs headderbutton"
								onclick="modifysubmit()">Submit</button>

							<button type="button"
								th:if="${(user_data.modify_flg == 'Y' and session.WORKCLASS == 'C' and 
								session.USERID != user_data.reviewed_by_ec_no) or  (user_data.modify_flg == 'Y' and 
								session.ROLEID == 'Superadmin') or  (user_data.modify_flg == 'Y' and session.WORKCLASS == 'C' and 
								session.ROLEID == 'DCD_ADMIN')}"
								class="btn btn-xs headderbutton" onclick="verifyrecord(this)"
								th:attr="data-srl_no=${user_data.srl_no}">
								Verify
							</button>

							<button type="reset" class="btn btn-xs headderbutton" onclick="goBack();">Back</button>
						</div>
					</div>
				</div>
			</div>
		</div>


		<!-- Success Modal -->
		<div class="modal fade" id="alert_success" tabindex="-1" role="dialog" aria-labelledby="modalLabel"
			aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
				<div class="modal-content">
					<div class="menu-title-header" style="background-color: #003366; padding: 10px;">
						<h5 class="modal-title" id="modalLabel" style="text-align: center; color: white; margin: 0;">
							BANK OF BARODA
						</h5>
					</div>
					<div class="modal-body" style="text-align: center; background-color: #c6ccd2;">
						<p id="alertmsg_success" style="font-size: 16px; color: black;"></p> <!-- Success message -->
						<button type="button" class="btn btn-primary" data-dismiss="modal"
							onclick="corporatehome();">Close</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Failure Modal -->
		<div class="modal fade" id="alert_failure">
			<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
				<div class="modal-content">
					<div class="menu-title-header" style="background-color: #003366; padding: 10px;">
						<h5 class="modal-title" id="exampleModalLabel"
							style="text-align: center; color: white; margin: 0;">
							BANK OF BARODA
						</h5>
					</div>
					<div class="modal-body" style="text-align: center; background-color: #c6ccd2;">
						<p id="alertmsg_failure" style="font-size: 16px;"></p> <!-- Failure message -->
						<button type="button" class="btn btn-primary" data-dismiss="modal"
							onclick="back();">Close</button>
					</div>
				</div>
			</div>
		</div>
		<!-- === MODALS (Place once, at the end of the body) === -->

		<!-- 1. Upload Modal -->
		<div class="modal fade" id="uploadModal" tabindex="-1">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Upload Documents</h5>
						<button type="button" class="close" data-dismiss="modal">×</button>
					</div>
					<div class="modal-body">
						<form id="uploadDocForm">
							<input type="hidden" name="srl_no" value="" />
							<input type="hidden" name="customer_id" value="" />
							<input type="hidden" name="customer_type" value="" />
						</form>
						<div class="form-group">
							<label for="documentFile">Select File(s) to Add:</label>
							<input type="file" class="form-control-file" id="documentFile"
								onchange="addFilesToList(event)" multiple>
						</div>
						<hr>
						<h6>Selected Files for Upload:</h6>
						<ul id="selectedFilesList" class="list-group">
							<li class="list-group-item text-muted">No files selected.</li>
						</ul>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="button" class="btn btn-primary" onclick="handleUploadSubmit()">Submit
							Upload</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 2. Download Modal -->
		<div class="modal fade" id="downloadModal" tabindex="-1">
			<div class="modal-dialog modal-dialog-centered modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Download Documents</h5>
						<button type="button" class="close" data-dismiss="modal">×</button>
					</div>
					<div class="modal-body">
						<div class="table-responsive">
							<table class="table table-striped table-bordered mt-2">
								<thead>
									<tr>
										<th>File Name</th>
										<th>Uploaded By</th>
										<th>Uploaded Date</th>
										<th class="text-center">Action</th>
									</tr>
								</thead>
								<tbody id="docListTableBody"></tbody>
							</table>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>

		<!--  *************************************************Loader Gif *********************************************************** -->
		<div class="modal fade" id="loader1" data-backdrop="static" data-keyboard="false">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content border-0 shadow-none bg-transparent">
					<div class="modal-body text-center p-0">
						<img th:src="@{/images/kycloader.gif}" id="bfirelogo"
							style="width: 50px; height: auto; background-color: transparent;" alt="Bornfire">
					</div>
				</div>
			</div>
		</div>


	</div>

	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const textarea = document.querySelector('[name="observations"]');
			const counter = document.getElementById("charCount");

			if (textarea) {
				textarea.addEventListener("input", function () {
					counter.textContent = `${textarea.value.length} / 999 characters`;
				});
			}
		});
	</script>
	<script>
		function togglePepRemarks() {
			const pepStatusSelect = document.getElementById("pep_status");
			const remarksField = document.getElementById("pep_remarks");

			if (pepStatusSelect && remarksField) {
				remarksField.disabled = (pepStatusSelect.value !== 'Yes');

				if (pepStatusSelect.value !== 'Yes') {
					remarksField.value = '';
				}
			}
		}
		document.addEventListener('DOMContentLoaded', togglePepRemarks);
	</script>

</body>

<!-- FINAL SCRIPT FOR CORPORATE MODIFY MODE -->

<script th:if="${formmode == 'modify'}">
	document.addEventListener("DOMContentLoaded", function () {
		const kycForm = document.getElementById('kycForm');
		if (!kycForm) {
			console.error("CRITICAL: The form with ID 'kycForm' was not found. The script cannot run.");
			return;
		}

		let originalSectionValues = {};

		// --- HELPER FUNCTIONS ---
		const formatNumber = (num) => (num === null || num === undefined || String(num).trim() === '') ? '' : new Intl.NumberFormat('en-US').format(String(num).replace(/,/g, ''));
		const unformatNumber = (str) => (typeof str === 'string') ? str.replace(/,/g, '') : str;
		const formatAllNumbers = (container) => container.querySelectorAll('.format-as-number').forEach(input => {if (input.value) input.value = formatNumber(input.value);});

		// --- FIELD DEPENDENCY LOGIC ---
		function handlePepStatusChange() {
			const pepRadioYes = document.querySelector('input[name="pep_status"][value="Yes"]');
			const pepRemarksField = document.querySelector('[name="pep_remarks"]');
			if (!pepRadioYes || !pepRemarksField) return;

			const isPepYes = pepRadioYes.checked;
			const isSectionDisabled = pepRadioYes.disabled;

			if (!isSectionDisabled) {
				pepRemarksField.disabled = !isPepYes;
				pepRemarksField.required = isPepYes;
				if (!isPepYes) {
					pepRemarksField.value = '';
				}
			}
		}

		function updateFieldDependencies() {
			handlePepStatusChange();
		}

		// --- EVENT LISTENERS FOR SECTION CONTROLS ---

		// MODIFY BUTTON
		document.querySelectorAll('.modify-btn').forEach(button => {
			button.addEventListener('click', function () {
				const actionsContainer = this.closest('.section-actions');
				const targetId = actionsContainer.dataset.target;
				const targetSection = document.getElementById(targetId);

				originalSectionValues[targetId] = {};
				targetSection.querySelectorAll('input:not([type=hidden]), select, textarea').forEach(el => {
					if (el.name) {
						if (el.type === 'radio') {
							if (el.checked) originalSectionValues[targetId][el.name] = el.value;
						} else {
							originalSectionValues[targetId][el.name] = el.value;
						}
					}
				});

				targetSection.querySelectorAll('input:not([type=hidden]), select, textarea').forEach(el => {
					if (!el.hasAttribute('readonly')) {el.disabled = false;}
				});
				updateFieldDependencies();
				actionsContainer.querySelector('.modify-btn').classList.add('d-none');
				actionsContainer.querySelector('.save-cancel-controls').classList.remove('d-none');
			});
		});

		// CANCEL BUTTON
		document.querySelectorAll('.cancel-btn').forEach(button => {
			button.addEventListener('click', function () {
				const actionsContainer = this.closest('.section-actions');
				const targetId = actionsContainer.dataset.target;
				const targetSection = document.getElementById(targetId);

				if (originalSectionValues[targetId]) {
					targetSection.querySelectorAll('input:not([type=hidden]), select, textarea').forEach(el => {
						const key = el.name;
						if (el.name && originalSectionValues[targetId].hasOwnProperty(key)) {
							if (el.type === 'radio') {
								el.checked = (el.value === originalSectionValues[targetId][key]);
							} else {
								el.value = originalSectionValues[targetId][key];
							}
						} else if (el.type !== 'radio' && el.type !== 'hidden' && !originalSectionValues[targetId].hasOwnProperty(key)) {
							el.value = '';
						}
					});
				}
				targetSection.querySelectorAll('input:not([type=hidden]), select, textarea').forEach(el => el.disabled = true);
				updateFieldDependencies();
				actionsContainer.querySelector('.modify-btn').classList.remove('d-none');
				actionsContainer.querySelector('.save-cancel-controls').classList.add('d-none');
			});
		});

		// *** SAVE BUTTON - UPDATED ***
		document.querySelectorAll('.save-btn').forEach(button => {
			button.addEventListener('click', async function () {
				const actionsContainer = this.closest('.section-actions');
				const targetSection = document.getElementById(actionsContainer.dataset.target);

				// 1. Validate the current section's fields
				for (const input of targetSection.querySelectorAll('input:not(:disabled), select:not(:disabled), textarea:not(:disabled)')) {
					if (!input.checkValidity()) {
						input.reportValidity(); // Show browser validation error
						return;
					}
				}

				// 2. Provide visual feedback on the button and disable it
				const saveIcon = this.querySelector('i.fa-spinner');
				this.disabled = true;
				if (saveIcon) saveIcon.classList.remove('d-none');

				// 3. Prepare form data for submission
				const allDisabledElements = Array.from(kycForm.querySelectorAll('input:disabled, select:disabled, textarea:disabled'));
				allDisabledElements.forEach(el => el.disabled = false);
				const formData = new FormData(kycForm);
				allDisabledElements.forEach(el => el.disabled = true);

				kycForm.querySelectorAll('.format-as-number').forEach(input => {
					if (formData.has(input.name)) {
						formData.set(input.name, unformatNumber(formData.get(input.name)));
					}
				});

				// 4. Attempt to save the data
				try {
					const response = await fetch(kycForm.action + '?ajax=true', {method: 'POST', body: formData});
					if (!response.ok) {
						// If server responds with an error, throw it to the catch block
						throw new Error(await response.text() || `Server error ${response.status}`);
					}

					// SUCCESS: Immediately reload the page.
					location.reload();

				} catch (error) {
					// FAILURE: Show a simple alert with the error message.
					console.error('Section save failed:', error);
					alert(`Save Failed: ${error.message}`);

					// Re-enable the button and hide spinner so the user can try again
					this.disabled = false;
					if (saveIcon) saveIcon.classList.add('d-none');
				}
			});
		});

		// --- INITIAL PAGE SETUP (RUNS ONCE) ---
		kycForm.querySelectorAll('input:not([type=hidden]), select, textarea').forEach(el => el.disabled = true);
		formatAllNumbers(kycForm);

		document.querySelectorAll('input[name="pep_status"]').forEach(radio => {
			radio.addEventListener('change', handlePepStatusChange);
		});
		updateFieldDependencies();
	});
</script>
<!-- FINAL, CORRECTED SCRIPT FOR VIEW MODE -->
<script th:if="${formmode == 'view'}">
	document.addEventListener("DOMContentLoaded", function () {
		const viewForm = document.getElementById('kycViewForm');
		if (!viewForm) return;

		// Helper function to format numbers with commas
		const formatNumber = (num) => {
			if (num === null || num === undefined || String(num).trim() === '') return '';
			const plainNumber = String(num).replace(/,/g, '');
			return new Intl.NumberFormat('en-US').format(plainNumber);
		};

		// 1. Disable all form elements INSIDE the view form only
		viewForm.querySelectorAll('input, select, textarea, button').forEach(el => {
			el.disabled = true;
		});

		// 2. Format any numeric fields for better readability
		viewForm.querySelectorAll('.format-as-number').forEach(input => {
			const formattedValue = formatNumber(input.value);
			input.value = formattedValue;
		});

		// 3. Prevent accidental edits by setting contenteditable to false (optional)
		viewForm.querySelectorAll('[contenteditable]').forEach(el => {
			el.setAttribute('contenteditable', 'false');
		});
	});
</script>
<script>
	// A global array to store files in the staging area.
	let fileListStore = [];
	const APP_CONTEXT_PATH = '/BRBS'; // Make sure this matches your application.properties

	function openUploadModal(srlNo, customerId, customerType) {
		fileListStore = [];
		updateSelectedFilesDisplay();
		const form = document.getElementById('uploadDocForm');
		form.querySelector('input[name="srl_no"]').value = srlNo;
		form.querySelector('input[name="customer_id"]').value = customerId;
		form.querySelector('input[name="customer_type"]').value = customerType;
		$('#uploadModal').modal('show');
	}

	async function openDownloadModal(customerId) {
		const tableBody = document.getElementById('docListTableBody');
		tableBody.innerHTML = '<tr><td colspan="4" class="text-center"><div class="spinner-border spinner-border-sm"></div> Loading...</td></tr>';
		$('#downloadModal').modal('show');
		try {
			const response = await fetch(`${APP_CONTEXT_PATH}/kyc/corporate/list-documents?customerId=${customerId}`);
			if (!response.ok) {throw new Error('Failed to fetch documents.');}
			const documents = await response.json();
			if (documents.length === 0) {
				tableBody.innerHTML = '<tr><td colspan="4" class="text-center">No documents found.</td></tr>';
				return;
			}
			let rowsHtml = '';
			documents.forEach(doc => {
				const formattedDate = new Date(doc.uploadedDate).toLocaleDateString('en-GB');
				rowsHtml += `
                    <tr>
                        <td>${doc.documentName || ''}</td>
                        <td>${doc.uploadedBy || ''}</td>
                        <td>${formattedDate}</td>
                        <td class="text-center">
                            <a href="${APP_CONTEXT_PATH}/kyc/corporate/download-doc/${doc.docId}" class="btn btn-sm btn-success" title="Download" download>
                                <i class="fas fa-download"></i>
                            </a>
                        </td>
                    </tr>`;
			});
			tableBody.innerHTML = rowsHtml;
		} catch (error) {
			console.error("Download list failed:", error);
			tableBody.innerHTML = `<tr><td colspan="4" class="text-center text-danger">Error fetching documents.</td></tr>`;
		}
	}

	function addFilesToList(event) {
		for (const file of event.target.files) {
			if (!fileListStore.some(f => f.name === file.name)) {
				fileListStore.push(file);
			}
		}
		event.target.value = null;
		updateSelectedFilesDisplay();
	}

	function removeFileFromList(index) {
		fileListStore.splice(index, 1);
		updateSelectedFilesDisplay();
	}

	function updateSelectedFilesDisplay() {
		const listElement = document.getElementById('selectedFilesList');
		if (fileListStore.length === 0) {
			listElement.innerHTML = '<li class="list-group-item text-muted">No files selected.</li>';
			return;
		}
		listElement.innerHTML = fileListStore.map((file, index) => `
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span class="text-truncate">${file.name}</span>
                <button type="button" class="btn btn-sm btn-danger ml-2" onclick="removeFileFromList(${index})">×</button>
            </li>`).join('');
	}

	async function handleUploadSubmit() {
		if (fileListStore.length === 0) {
			alert('Please select at least one file.');
			return;
		}
		
		$('#uploadModal').modal('hide');

		const form = document.getElementById('uploadDocForm');
		const formData = new FormData();
		formData.append('srl_no', form.querySelector('input[name="srl_no"]').value);
		formData.append('customer_id', form.querySelector('input[name="customer_id"]').value);
		formData.append('customer_type', form.querySelector('input[name="customer_type"]').value);
		fileListStore.forEach(file => formData.append('files', file));

		try {
			const response = await fetch(`${APP_CONTEXT_PATH}/kyc/corporate/upload-document`, {
				method: 'POST',
				body: formData
			});
			if (!response.ok) {throw new Error(await response.text());}
			$("#alertmsg_success").text("Documents uploaded successfully!");
			$("#alert_success").modal("show");
			$('#alert_success .btn-primary').attr("onclick", "location.reload(true);");
		} catch (error) {
			console.error("Upload failed:", error);
			$("#alertmsg_failure").text("Upload failed: " + error.message);
			$("#alert_failure").modal("show");
		} finally {
			
		}
	}
</script>


</html>